/*
 * Created by: Omar Abouel Maaty
 * Created on: 11/10/2024
 * Description: Queries to identify any data issues observed in the fetch.brands and fetch.rewardsreceiptitems 
 * 				and their relation to one another
 */

-- -------------------------------------------------- QUERY 1 -------------------------------------------------- --
/*	
 * The below first query identifies questionable data consistency throughout the brands table
 *  ________________________________________________________________________________________________________________
*/
SELECT 
    a.MissingBrandCodeCount,
    b.MissingCategoryCount,
    c.MissingCategoryCodeCount,
    d.TestNameCount
FROM 
    (SELECT COUNT(*) AS MissingBrandCodeCount FROM fetch.brands WHERE brandCode IS NULL OR brandCode = '') a
CROSS JOIN
    (SELECT COUNT(*) AS MissingCategoryCount FROM fetch.brands WHERE category IS NULL OR category = '') b
CROSS JOIN
    (SELECT COUNT(*) AS MissingCategoryCodeCount FROM fetch.brands WHERE categoryCode IS NULL OR categoryCode = '') c
CROSS JOIN
    (SELECT COUNT(*) AS TestNameCount FROM fetch.brands WHERE LOWER(name) LIKE '%test%') d;
   
/*
 *  ________________________________________________________________________________________________________________
 * SUMMARY
 * MissingBrandCodeCount: Around 269 records are missing a barCode value, which can lead to inaccurate reporting
 * 						  regarding brands and the customer receipts on file.
 * 
 * MissingCategoryCount: Around 155 records are missing a category which impacts categorization accuracy.
 * 
 * MissingCategoryCodeCount: 650, over half of the records have a missing categoryCode but not nearly as much
 * 						     are missing the Category column. This indicates a consistency issue with how we are
 * 							 assigning categories with respect to their code.
 * 
 * TestNameCount: Around 432 records seem to be test records inserted in the production dataset. We may need to consider
 * 				  removing or flagging these test rows, as they can skew any analysis on brands and population.
 ________________________________________________________________________________________________________________
 * RESULTS 1 row(s) fetched - 0.002s, on 2024-11-10 at 11:56:55
 
#	MissingBrandCodeCount	MissingCategoryCount	MissingCategoryCodeCount	TestNameCount
1	269						155						650							432
 ________________________________________________________________________________________________________________ 
*/
   
-- -------------------------------------------------- QUERY 2 -------------------------------------------------- --
/*	
 * The below second query identifies missing brand records in our table using the rewardsReceiptItems table.
 *  ________________________________________________________________________________________________________________
*/   
SELECT 
    DISTINCT ri.barcode
FROM 
    fetch.rewardsReceiptItems ri
LEFT JOIN 
    fetch.brands b ON ri.barcode = b.barcode
WHERE 
    (ri.barcode IS NOT NULL AND ri.barcode != '')
    AND b.barcode IS NULL
ORDER BY 
    ri.barcode;

/*
 *  ________________________________________________________________________________________________________________
 * SUMMARY
 * Around 552 distinct barcodes that were scanned via the receipt and rewardReceiptItems table have no matching result
 * in our brands dataset. This can indicate that our table is out of date, and would need to collaborate with the
 * brand team to understand how we can backfill the missing records into the brands table
 ________________________________________________________________________________________________________________
 * RESULTS 552 row(s) fetched - 0.256s, on 2024-11-10 at 12:04:04
#	barcode
1	000980000069
2	001111132666
3	001111147332
4	005111116022
5	007874242956
6	007940018942
7	009800300037
8	011110073747
9	011110603746
10	011110847454
11	011110857132
12	011110876942
13	011110916068
14	011110916600
15	011110973009
16	011110974525
17	011111326231
18	011594404013
19	012000000171
20	012000004919
21	012000010736
22	012000106057
23	012000171864
24	012000809941
25	012000809965
26	012000810022
27	013000000635
28	013000006187
29	013000009263
30	013000010917
31	013000657600
32	013000798303
33	013000798952
34	013000799102
35	013000993906
36	013120000843
37	013120002588
38	013120013966
39	013120014178
40	013562300631
41	013800100320
42	013800104083
43	013800190215
44	014100095071
45	014113910026
46	014113911979
47	015000056087
48	015300430594
49	015800030621
50	016000123151
51	016000124790
52	016000126855
53	016000128620
54	016000147096
55	016000151024
56	016000156234
57	016000363779
58	016000437760
59	016000493025
60	016000496361
61	016000854307
62	016000877009
63	016000898264
64	016300165912
65	017696004519
66	018627030010
67	019582000117
68	019600920106
69	020169222341
70	020709100139
71	021000001361
72	021000002917
73	021000006106
74	021000007363
75	021000007561
76	021000007660
77	021000012961
78	021000013869
79	021000018710
80	021000024582
81	021000024674
82	021000024834
83	021000024858
84	021000024926
85	021000026999
86	021000029778
87	021000030453
88	021000032778
89	021000034574
90	021000037186
91	021000037490
92	021000039340
93	021000040247
94	021000043552
95	021000045006
96	021000045129
97	021000046904
98	021000049318
99	021000049325
100	021000050765
101	021000051038
102	021000051113
103	021000051885
104	021000052363
105	021000054190
106	021000054473
107	021000054602
108	021000054862
109	021000054961
110	021000055005
111	021000055920
112	021000057832
113	021000059232
114	021000065127
115	021000065547
116	021000068036
117	021000068159
118	021000068364
119	021000068760
120	021000068852
121	021000068883
122	021000069293
123	021000070787
124	021000604647
125	021000604906
126	021000612239
127	021000615315
128	021000633609
129	021000642182
130	021000644551
131	021000648863
132	021000658831
133	021000667543
134	021000678358
135	021000679201
136	021000701445
137	021000725403
138	021000744152
139	021131506940
140	021834033316
141	021908236865
142	022000014252
143	022174070214
144	023400022212
145	024105590051
146	025155000149
147	025400076363
148	025500005188
149	025500202310
150	025500204215
151	025800000135
152	025800000159
153	025800000524
154	025800020300
155	025800026302
156	026542084018
157	026800001924
158	028189000079
159	028400003988
160	028400081382
161	028400641326
162	028400642033
163	028400642255
164	028400643061
165	028435383253
166	028800296737
167	029000012578
168	029000015630
169	029000016156
170	029000016187
171	029000016705
172	029000017986
173	029000019034
174	029000019201
175	029000019416
176	029000020344
177	029000020351
178	029000021273
179	029000021723
180	029000023666
181	029000024748
182	029000073692
183	029000074361
184	029000079236
185	030000562383
186	030100001331
187	034000040476
188	034000056644
189	034100573065
190	034695123621
191	036000119749
192	036000162905
193	036000320893
194	036000391718
195	036000432190
196	036000478044
197	036000485967
198	036000494129
199	036000495737
200	036632011077
201	036632013095
202	036632037541
203	037000889427
204	037000979715
205	037466016023
206	037466017631
207	038000052200
208	038000138577
209	038000924224
210	039400015031
211	041000004087
212	041000022623
213	041000022906
214	041000168468
215	041129000052
216	041129002292
217	041129088005
218	041129411506
219	041129412152
220	041129634608
221	041196277470
222	041235000328
223	041235000687
224	041244000098
225	041258081601
226	041260362873
227	041289895406
228	041321006357
229	041390024368
230	041449001401
231	041449402529
232	041483022226
233	041483030917
234	041500220208
235	041695103799
236	041695151721
237	041695951130
238	041800200139
239	042222302005
240	042222336413
241	042800108005
242	043000000175
243	043000000199
244	043000000342
245	043000000960
246	043000003596
247	043000004944
248	043000005217
249	043000006283
250	043000008836
251	043000009604
252	043000012871
253	043000013229
254	043000023440
255	043000032275
256	043000035818
257	043000041994
258	043000043486
259	043000043790
260	043000046814
261	043000048528
262	043000050910
263	043000057162
264	043000058145
265	043000058404
266	043000060544
267	043000061732
268	043000061978
269	043000062753
270	043000062760
271	043000063897
272	043000065198
273	043000066706
274	043000068649
275	043000071182
276	043000075340
277	043000075821
278	043000077467
279	043000078488
280	043000079232
281	043000079904
282	043000080443
283	043000081099
284	043000081501
285	043000082294
286	043000200520
287	043000204399
288	043000204405
289	043000204443
290	043000206515
291	043000285213
292	043000716021
293	043000946060
294	043000955628
295	043000956113
296	043000971635
297	044000000745
298	044000034030
299	044000039905
300	044000043254
301	044000051051
302	044300107700
303	044500341720
304	044600020020
305	044700002810
306	044700009000
307	044700009888
308	044700019917
309	044700024119
310	044700030479
311	044700031711
312	044700033302
313	044700061909
314	044700064238
315	044700065617
316	044700070840
317	044700071533
318	044700071748
319	044700072813
320	044700073377
321	044700073933
322	044700074602
323	044700075302
324	044700076422
325	044700087145
326	044700087329
327	044700087558
328	044700092408
329	044700096284
330	044700096321
331	044700098752
332	045255148947
333	046000288697
334	046000400280
335	046000721835
336	046000832517
337	046704085905
338	046704096802
339	048000007070
340	048001154032
341	048001154049
342	048001213517
343	048001412538
344	048121229030
345	048500052020
346	048500256763
347	049000010633
348	049000012781
349	049900000345
350	050000274444
351	051000228895
352	051500720011
353	051600001003
354	051611165893
355	051700788262
356	052100037509
357	052100587967
358	052100625348
359	053000069867
360	053800123004
361	058449450023
362	058496723002
363	068113135477
364	070085035006
365	070085038403
366	070085046583
367	070158008678
368	070221006693
369	070277290107
370	070446400009
371	070470137735
372	070470149394
373	070470400235
374	070492140003
375	070800179329
376	071007023095
377	071040063102
378	071040063188
379	071100006681
380	071100007077
381	071100007299
382	071100200058
383	071100211474
384	071100309744
385	071142004089
386	071146002487
387	071159001750
388	071159020195
389	071279275024
390	071430000724
391	071430010051
392	071840205009
393	071871542067
394	072220001808
395	072310001244
396	072310001459
397	072785048119
398	073410955505
399	074682200294
400	074714086643
401	074714086827
402	074904100104
403	075450079760
404	075450085150
405	075450093070
406	075450120400
407	075706191031
408	075706304783
409	075856000269
410	075925306254
411	076001350437
412	076828048432
413	076840100354
414	076840100477
415	076840400218
416	076840580750
417	077298000043
418	077567000637
419	077567304124
420	077661120460
421	077661137833
422	078000010367
423	078000082401
424	078300054764
425	078742052328
426	078742112138
427	078742333960
428	078742348315
429	078742372198
430	079400066619
431	079400236425
432	079400245328
433	082242012362
434	084114111722
435	085000015889
436	085718300512
437	087684001127
438	087684002872
439	087684004449
440	087684009000
441	087684009338
442	089203700016
443	1234
444	20750000000
445	21075100000
446	212245400006
447	21251000000
448	22
449	23572500000
450	23671200000
451	26623200000
452	2700710686201
453	2700719497082
454	305210154278
455	305731769135
456	305731769203
457	311111149350
458	311111208538
459	311111242129
460	311111434807
461	311111445421
462	311111452382
463	311111511867
464	311111536044
465	311111603920
466	311111705006
467	311111806949
468	3283
469	3332
470	3435
471	4011
472	4023
473	4053
474	4060
475	4061
476	4066
477	4067
478	4068
479	4069
480	4072
481	4078
482	4090
483	4093
484	4131
485	4135
486	4166
487	4225
488	4540
489	4562
490	4563
491	4608
492	4614
493	4662
494	4759
495	4816
496	5000111047524
497	600699001564
498	605806001307
499	611443010787
500	612669316714
501	633472322587
502	665290001184
503	681131091206
504	681131122764
505	686924113172
506	686924155783
507	686924291290
508	686924560242
509	686924820858
510	689544081937
511	689544083405
512	737628011506
513	754500024805
514	754500326305
515	754500355602
516	754500363409
517	754500486009
518	754500638101
519	754500797204
520	754500947500
521	754500947807
522	754500958803
523	754500973400
524	754500990209
525	754501311409
526	754501315209
527	754501734109
528	754502285808
529	759283001890
530	759283400082
531	764025930000
532	767707013299
533	780993107565
534	792851356565
535	798813118547
536	815473010360
537	815473012357
538	815473013279
539	822142991523
540	857183005120
541	857484001159
542	861745000010
543	884912006806
544	887214041018
545	889714000038
546	896859000489
547	94023
548	94094
549	B076FJ92M4
550	B07BRRLSVC
551	B08BGBHHP6
552	B08DQDHR2S
 ________________________________________________________________________________________________________________ 
*/

